---
title: "Descriptive Statistics"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load packages
```{r load tidyverse and hmisc, message = FALSE}
library(tidyverse)
library(Hmisc) # install.packages("Hmisc")
library(MBESS)
```

Load in data.

```{r load in data, message = FALSE, warning = FALSE}
sad_data <- read_csv("total_data.csv")
```

Retain only those variables required to match the correlation matrix in the original manuscript.

```{r filter variables of dataset}
var_int <- c("anticipating", "savoring_moment", "reminiscing", "masq_pa", "masq_na", "masq_aa", "phq_total", "pswq_total")
sad_data_int <- sad_data %>% 
  select(var_int)
```

Create correlation matrix.

```{r correlation matrix}
# data frame must be converted to matrix type for function to work.
rcorr(as.matrix(sad_data_int))
# for additional decimals
cor(as.matrix(sad_data_int))
```

```{r create empty data frame for descriptive statistics}
dep_group <- tibble("Depression Group" = c("Minimal", "Mild", "Moderate", "Moderately Severe", "Severe"),
                    "n" = NA,
                    "%" = NA,
                    "PA Mean" = NA,
                    "PA SD" = NA,
                    "PA $\\\\omega$" = NA,
                    "NA Mean" = NA,
                    "NA SD" = NA,
                    "NA $\\\\omega$" = NA,
                    "StM Mean" = NA,
                    "StM SD" = NA,
                    "Stm $\\\\omega$" = NA
                    )
```

```{r create severity designation variable based on descriptors from Kroenke et al., 2001}
sad_data_severity <- sad_data %>% 
  mutate("severity" = if_else(phq_total > 20, "Severe", 
                              if_else(phq_total > 15, "Moderately Severe",
                                      if_else(phq_total > 10, "Moderate",
                                              if_else(between(phq_total, 5, 9), "Mild", "a_Minimal")
                                             )
                                      )
                              )
         )
```

```{r create data frame for n, percent, mean, and sd for each variable}
n <- sad_data_severity %>%
  split(.$severity) %>% 
  map_df(~ {
    nrow(.x)
    }) %>% 
  mutate(header = "n") %>% 
  select(header, everything())

percent <- sad_data_severity %>%
  split(.$severity) %>% 
  map_df(~ {
    "n" = round(nrow(.x) / nrow(sad_data_severity) * 100, digits = 2)
    }) %>% 
  mutate(header = "\\\\%") %>% 
  select(header, everything())

mean_pa <- sad_data_severity %>% 
  split(.$severity) %>% 
  map_df(~ {
    round(mean(.x$masq_pa), digits = 2)
  }) %>% 
  mutate(header = "PA Mean") %>% 
  select(header, everything())

sd_pa <- sad_data_severity %>% 
  split(.$severity) %>% 
  map_df(~ { 
    round(sd(.x$masq_pa), digits = 2)
    }) %>% 
  mutate(header = "PA SD") %>% 
  select(header, everything())

mean_na <- sad_data_severity %>% 
  split(.$severity) %>% 
  map_df(~ {
    round(mean(.x$masq_na), digits = 2)
  }) %>% 
  mutate(header = "NA Mean") %>% 
  select(header, everything())

sd_na <- sad_data_severity %>% 
  split(.$severity) %>% 
  map_df(~ { 
    round(sd(.x$masq_na), digits = 2)
    }) %>% 
  mutate(header = "NA SD") %>% 
  select(header, everything())

mean_stm <- sad_data_severity %>% 
  split(.$severity) %>% 
  map_df(~ {
    round(mean(.x$savoring_moment), digits = 2)
  }) %>% 
  mutate(header = "StM Mean") %>% 
  select(header, everything())

sd_stm <- sad_data_severity %>% 
  split(.$severity) %>% 
  map_df(~ { 
    round(sd(.x$savoring_moment), digits = 2)
    }) %>% 
  mutate(header = "StM SD") %>% 
  select(header, everything())
```

```{r now derive macdonald's omega for each partitioned group}
# designate items for each variable
pa_items <- c("masq_2", "masq_4", "masq_5", "masq_7", "masq_11", "masq_14", "masq_19", "masq_23", "masq_26", "masq_28", "masq_32", "masq_34", "masq_36", "masq_37")
na_items <- c("masq_9", "masq_13", "masq_17", "masq_21", "masq_29", "masq_30", "masq_35", "masq_38")
moment_items <- c("sbi_5", "sbi_11", "sbi_17", "sbi_23", "sbi_2_r", "sbi_8_r", "sbi_14_r", "sbi_20_r")

# list of depression groups to be used with map functions
dep_groups <- list(a_Minimal = "a_Minimal",
                   Mild = "Mild",
                   Moderate = "Moderate",
                   `Moderately Severe` = "Moderately Severe",
                   Severe = "Severe")

# define function that calculates omega with severity group and items as arguments
omega <- function(sev, items) {
  sad_data_severity %>%
  filter(severity == sev) %>%
  select(items) %>% 
  ci.reliability(., type = "omega")
}

# make a list of all the groups of items that have to be used to calculate omega
all_items <- list(pa = pa_items,
                  na = na_items,
                  stm = moment_items)

# define another very cool function function that will iterate over the list of items and output a data frame containing macdonald's 
# omega for each variable partitioned by severity group.
cool <- function(items) {
map(dep_groups, ~ round(omega(.x, items)$est, digits = 2))
}

# run the function
dep_group_omega <- map_df(all_items, ~ cool(.x))

dep_group_omega <- dep_group_omega %>% 
  mutate(header = c("PA $\\\\omega$",
                 "NA $\\\\omega$",
                 "StM $\\\\omega$")
  ) %>% 
  select(header, everything())
```

```{r merge all data frames together}
final_df <- bind_rows(n, percent, mean_pa, sd_pa, mean_na, sd_na, mean_stm, sd_stm, dep_group_omega)
names(final_df)[1:2] <- c(" ", "Minimal")
```

